name: Ubuntu RDP

on:
  workflow_dispatch:

jobs:
  ubuntu-rdp:
    runs-on: ubuntu-20.04
    timeout-minutes: 360

    steps:
      - name: Update system
        run: |
          sudo apt update

      - name: Install Desktop & XRDP
        run: |
          sudo apt install -y ubuntu-desktop xrdp
          sudo systemctl enable xrdp
          sudo systemctl start xrdp

      - name: Create RDP User
        run: |
          sudo useradd -m rdp
          echo "rdp:rdp1234" | sudo chpasswd
          sudo usermod -aG sudo rdp

      - name: Install Tailscale
        run: |
          curl -fsSL https://tailscale.com/install.sh | sh

      - name: Connect to Tailscale
        run: |
          sudo tailscale up --authkey=${{ secrets.TAILSCALE_AUTH_KEY }} --hostname=gh-ubuntu-rdp

      - name: Show connection info
        run: |
          echo "=========================="
          echo "RDP User: rdp"
          echo "RDP Pass: rdp1234"
          tailscale ip -4
          echo "=========================="

      - name: Keep alive
        run: |
          while true; do sleep 300; done
